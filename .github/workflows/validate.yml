name: Validate Final Submission

on:
  pull_request:
    branches:
      - '**'

jobs:
  validate-submission:
    name: Validate PR
    runs-on: ubuntu-latest

    env:
      TARGET_BRANCH: ${{ secrets.CORRECT_BRANCH }}
      BACKGROUND_COLOR: ${{ secrets.CORRECT_COLOR }}
      HEADER_TEXT: ${{ secrets.CORRECT_HEADER_TEXT }}
      HEADER_SIZE: ${{ secrets.CORRECT_HEADER_SIZE }}
      IMAGE_HASH: ${{ secrets.CORRECT_IMAGE_HASH }}
      IMAGE_NAME: ${{ secrets.CORRECT_IMAGE_NAME }}
      LINK_URL: ${{ secrets.CORRECT_LINK_URL }}
      SECRET_PHRASE: ${{ secrets.CORRECT_PHRASE }}

    steps:
      - name: Check out PR branch
        uses: actions/checkout@v3

      - name: Install Python dependencies
        run: pip install beautifulsoup4 lxml

      - name: ✅ Check PR Target Branch
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-branch || echo "check-branch FAIL" >> result.log

      - name: ✅ Check PR Secret Phrase
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-pr-message || echo "check-pr-message FAIL" >> result.log

      - name: ✅ Check Background Color
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-background || echo "check-background FAIL" >> result.log

      - name: ✅ Check Header Text
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-header-text || echo "check-header-text FAIL" >> result.log

      - name: ✅ Check Header Tag Level
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-header-size || echo "check-header-size FAIL" >> result.log

      - name: ✅ Check Image Name
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-image-name || echo "check-image-name FAIL" >> result.log

      - name: ✅ Check Image Link
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-image-link || echo "check-image-link FAIL" >> result.log

      - name: ✅ Check Image Hash
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-image-hash || echo "check-image-hash FAIL" >> result.log

      - name: ✅ Check Submission Lockout
        continue-on-error: true
        run: |
          python3 scripts/validate.py check-lockout || echo "check-lockout FAIL" >> result.log

      - name: ❌ Final Merge Blocker
        run: |
          if [ -f result.log ]; then
            echo "❌ One or more checks failed:"
            cat result.log
            exit 1
          else
            echo "✅ All checks passed."
          fi
